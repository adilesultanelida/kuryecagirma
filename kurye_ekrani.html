<script>
  const ding = new Audio("https://www.soundjay.com/button/beep-07.wav");
  const statusText = document.getElementById("status");
  const countdownText = document.getElementById("countdown");
  let lastPing = null;
  let countdownInterval = null;
  let countdownSeconds = 60;

  // TarayÄ±cÄ±dan bildirim izni iste
  if (Notification.permission !== "granted") {
    Notification.requestPermission();
  }

  function startCountdown() {
    countdownSeconds = 60;
    countdownText.innerText = `Kalan: ${countdownSeconds} sn`;
    countdownInterval = setInterval(() => {
      countdownSeconds--;
      countdownText.innerText = `Kalan: ${countdownSeconds} sn`;

      if (countdownSeconds <= 0) {
        clearInterval(countdownInterval);
        statusText.innerText = "HazÄ±r, Ã§aÄŸrÄ± bekleniyor...";
        countdownText.innerText = "";
      }
    }, 1000);
  }

  async function checkPing() {
    try {
      const res = await fetch("/api/ping.json");
      const data = await res.json();

      if (lastPing !== data.time) {
        lastPing = data.time;
        statusText.innerText = "ğŸ“¢ Kurye Ã§aÄŸrÄ±ldÄ±!";
        
        // Bildirim gÃ¶nder
        if (Notification.permission === "granted") {
          new Notification("Kurye Ã‡aÄŸrÄ±sÄ±", { body: "MÃ¼dÃ¼r seni Ã§aÄŸÄ±rdÄ±!", icon: "https://cdn-icons-png.flaticon.com/512/1827/1827349.png" });
        }

        // Ses Ã§al (mobilde etkileÅŸimli deÄŸilse Ã§almaz)
        ding.play().catch(() => {});

        // SayaÃ§ baÅŸlat
        if (countdownInterval) clearInterval(countdownInterval);
        startCountdown();
      }

    } catch {
      statusText.innerText = "âŒ BaÄŸlantÄ± hatasÄ±!";
      countdownText.innerText = "";
    }
  }

  setInterval(checkPing, 3000);
</script>
